<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Área do Passageiro - AC Transporte</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="assets/logo.jpg">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Leaflet Maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body class="passenger-page">
  <!-- WhatsApp Float -->
  <a href="https://wa.me/559392059914?text=Olá,%20preciso%20de%20suporte%20no%20app%20AC%20Transporte" 
     target="_blank" class="whatsapp-float">
    <i class="fab fa-whatsapp"></i>
  </a>
  
  <!-- Header -->
  <header class="passenger-header">
    <div class="container">
      <div class="header-content">
        <button class="back-btn" onclick="goBack()">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="passenger-info">
          <div class="passenger-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div>
            <h2>Passageiro</h2>
            <p>Acompanhe sua rota em tempo real</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="darkToggle" title="Alternar tema">
            <i class="fas fa-moon"></i>
          </button>
          <button class="icon-btn" onclick="logout()" title="Sair">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>
    </div>
  </header>
  
  <!-- Clima Atual -->
  <section id="weatherSection" class="container">
    <div class="weather-card">
      <div class="weather-info">
        <h3><i class="fas fa-cloud-sun"></i> Clima Atual</h3>
        <div class="weather-temp" id="currentTemp">--°C</div>
        <div class="weather-desc" id="weatherDesc">Carregando...</div>
        <small id="weatherLocation">Localização atual</small>
      </div>
      <div class="weather-icon" id="weatherIcon">
        <i class="fas fa-sun"></i>
      </div>
    </div>
  </section>
  
  <!-- Menu Principal Passageiro -->
  <main class="container">
    <div class="passenger-dashboard">
      <!-- Avisos e Comunicados -->
      <div class="dashboard-card" onclick="openNotices()" data-animation="ripple">
        <div class="card-icon" style="background: #FF9800;">
          <i class="fas fa-bullhorn"></i>
        </div>
        <div class="card-content">
          <h3>Avisos e Comunicados</h3>
          <p>Informações importantes sobre as rotas</p>
          <div class="card-badge" id="noticeBadge">0 novos</div>
        </div>
        <div class="card-arrow">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
      
      <!-- Ver Rota e Motorista -->
      <div class="dashboard-card" onclick="openRouteTracking()" data-animation="ripple">
        <div class="card-icon" style="background: #2196F3;">
          <i class="fas fa-bus"></i>
        </div>
        <div class="card-content">
          <h3>Ver Rota e Motorista</h3>
          <p>Acompanhe sua rota e veja onde está o motorista</p>
          <div class="card-status" id="driverStatus">Motoristas disponíveis: 3</div>
        </div>
        <div class="card-arrow">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
      
      <!-- Feedback e Sugestões -->
      <div class="dashboard-card" onclick="openFeedback()" data-animation="ripple">
        <div class="card-icon" style="background: #607D8B;">
          <i class="fas fa-comment-dots"></i>
        </div>
        <div class="card-content">
          <h3>Feedback</h3>
          <p>Envie sugestões ou reclamações sobre o serviço</p>
          <div class="card-badge" id="feedbackBadge"></div>
        </div>
        <div class="card-arrow">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
      
      <!-- Suporte -->
      <div class="dashboard-card" onclick="openSupport()" data-animation="ripple">
        <div class="card-icon" style="background: #795548;">
          <i class="fas fa-headset"></i>
        </div>
        <div class="card-content">
          <h3>Suporte</h3>
          <p>Entre em contato para dúvidas ou problemas</p>
          <div class="card-status">WhatsApp: (93) 9205-9914</div>
        </div>
        <div class="card-arrow">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
    </div>
    
    <!-- Status das Rotas em Tempo Real -->
    <div class="routes-status">
      <h3><i class="fas fa-map-marker-alt"></i> Status das Rotas</h3>
      <div class="status-grid" id="routesStatusGrid">
        <!-- Status será preenchido via JavaScript -->
      </div>
    </div>
  </main>
  
  <!-- Modal de Avisos -->
  <div id="noticesModal" class="modal-back" style="display: none;">
    <div class="modal notices-modal">
      <button class="close" onclick="closeModal('noticesModal')">✕</button>
      <h3><i class="fas fa-bullhorn"></i> Avisos para Passageiros</h3>
      
      <div class="notices-filter">
        <button class="filter-btn active" onclick="filterNotices('all')">Todos</button>
        <button class="filter-btn" onclick="filterNotices('route')">Rotas</button>
        <button class="filter-btn" onclick="filterNotices('schedule')">Horários</button>
      </div>
      
      <div class="notices-list" id="noticesList">
        <div class="notice-item info">
          <div class="notice-header">
            <span class="notice-badge info">INFORMAÇÃO</span>
            <span class="notice-date">Hoje, 09:00</span>
          </div>
          <h4>Novo Horário Rota 01</h4>
          <p>A Rota 01 terá saídas a cada 30 minutos a partir de segunda-feira.</p>
        </div>
        
        <div class="notice-item">
          <div class="notice-header">
            <span class="notice-badge warning">ATENÇÃO</span>
            <span class="notice-date">Ontem, 15:30</span>
          </div>
          <h4>Desvio Rota 02</h4>
          <p>Devido a obras, a Rota 02 terá desvio temporário na Av. Principal.</p>
        </div>
      </div>
      
      <div class="notices-empty" id="noNotices" style="display: none;">
        <i class="fas fa-inbox"></i>
        <p>Nenhum aviso no momento</p>
      </div>
    </div>
  </div>
  
  <!-- Modal de Acompanhamento de Rota -->
  <div id="trackingModal" class="modal-back" style="display: none;">
    <div class="modal tracking-modal">
      <button class="close" onclick="closeModal('trackingModal')">✕</button>
      <h3><i class="fas fa-bus"></i> Acompanhar Rota</h3>
      
      <!-- Seleção de Rota -->
      <div class="route-selection">
        <div class="form-group">
          <label for="selectRoute"><i class="fas fa-route"></i> Selecione sua rota:</label>
          <select id="selectRoute" onchange="loadRouteDrivers()">
            <option value="">Escolha uma rota</option>
            <option value="adm-01">ROTA ADM 01</option>
            <option value="adm-02">ROTA ADM 02</option>
            <option value="01">ROTA 01</option>
            <option value="02">ROTA 02</option>
            <option value="03">ROTA 03</option>
            <option value="04">ROTA 04</option>
          </select>
        </div>
      </div>
      
      <!-- Informações da Rota -->
      <div class="route-info-card" id="routeInfo" style="display: none;">
        <div class="route-header">
          <h4 id="routeName">Nome da Rota</h4>
          <span class="route-status" id="routeOverallStatus">Status</span>
        </div>
        <div class="route-details">
          <div class="detail-item">
            <i class="fas fa-clock"></i>
            <div>
              <small>Duração</small>
              <p id="routeDuration">-- min</p>
            </div>
          </div>
          <div class="detail-item">
            <i class="fas fa-map-pin"></i>
            <div>
              <small>Paradas</small>
              <p id="routeStops">--</p>
            </div>
          </div>
          <div class="detail-item">
            <i class="fas fa-bus"></i>
            <div>
              <small>Motoristas</small>
              <p id="routeDriversCount">0</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Mapa de Localização -->
      <div class="location-map" id="trackingMap">
        <div class="map-placeholder">
          <i class="fas fa-map-marked-alt"></i>
          <p>Selecione uma rota para ver o mapa</p>
        </div>
      </div>
      
      <!-- Motoristas Disponíveis -->
      <div class="drivers-list" id="driversList">
        <h4>Motoristas nesta rota</h4>
        <div class="driver-card" id="driverTemplate" style="display: none;">
          <div class="driver-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="driver-info">
            <h5 class="driver-name">Nome do Motorista</h5>
            <p class="driver-vehicle">Ônibus: <span class="vehicle-number">--</span></p>
            <div class="driver-status">
              <span class="status-indicator"></span>
              <span class="status-text">Status</span>
            </div>
          </div>
          <div class="driver-actions">
            <button class="btn-track" onclick="trackDriver(this)">
              <i class="fas fa-eye"></i> Acompanhar
            </button>
            <button class="btn-open-route" onclick="openPassengerRoute()">
              <i class="fas fa-map-marked-alt"></i> Rota
            </button>
          </div>
        </div>
        
        <div class="no-drivers" id="noDrivers">
          <i class="fas fa-bus-slash"></i>
          <p>Nenhum motorista ativo nesta rota no momento</p>
        </div>
      </div>
      
      <!-- Detalhes do Motorista Selecionado -->
      <div class="driver-details-card" id="driverDetails" style="display: none;">
        <div class="driver-header">
          <div class="driver-avatar-large">
            <i class="fas fa-user"></i>
          </div>
          <div>
            <h4 id="selectedDriverName">Nome do Motorista</h4>
            <p id="selectedDriverVehicle">Ônibus: --</p>
          </div>
        </div>
        
        <div class="driver-stats">
          <div class="stat-item">
            <i class="fas fa-tachometer-alt"></i>
            <div>
              <small>Velocidade</small>
              <p id="driverSpeed">-- km/h</p>
            </div>
          </div>
          <div class="stat-item">
            <i class="fas fa-map-marker-alt"></i>
            <div>
              <small>Última atualização</small>
              <p id="lastUpdateTime">--:--</p>
            </div>
          </div>
          <div class="stat-item">
            <i class="fas fa-route"></i>
            <div>
              <small>Progresso</small>
              <p id="routeProgress">0%</p>
            </div>
          </div>
        </div>
        
        <div class="estimated-arrival">
          <h5><i class="fas fa-clock"></i> Chegada Estimada</h5>
          <div class="arrival-time" id="estimatedArrival">--:--</div>
          <div class="arrival-info">
            <span id="arrivalDistance">-- km</span> •
            <span id="arrivalTime">-- min</span>
          </div>
        </div>
        
        <button class="btn-notify" onclick="notifyDriverArrival()">
          <i class="fas fa-bell"></i> Notificar quando estiver chegando
        </button>
      </div>
    </div>
  </div>
  
  <!-- Modal de Feedback -->
  <div id="feedbackModal" class="modal-back" style="display: none;">
    <div class="modal feedback-modal">
      <button class="close" onclick="closeModal('feedbackModal')">✕</button>
      <h3><i class="fas fa-comment-dots"></i> Feedback do Passageiro</h3>
      
      <div class="feedback-tabs">
        <button class="tab-btn active" onclick="openTab('service')">Serviço</button>
        <button class="tab-btn" onclick="openTab('app')">Aplicativo</button>
        <button class="tab-btn" onclick="openTab('history')">Histórico</button>
      </div>
      
      <div class="tab-content active" id="service">
        <div class="form-group">
          <label for="serviceType">Tipo de Feedback:</label>
          <select id="serviceType">
            <option value="praise">Elogio ao Motorista</option>
            <option value="complaint">Reclamação do Serviço</option>
            <option value="suggestion">Sugestão de Melhoria</option>
            <option value="delay">Atraso no Transporte</option>
            <option value="other">Outro</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="routeFeedback">Rota:</label>
          <select id="routeFeedback">
            <option value="">Selecione a rota</option>
            <option value="adm-01">ROTA ADM 01</option>
            <option value="adm-02">ROTA ADM 02</option>
            <option value="01">ROTA 01</option>
            <option value="02">ROTA 02</option>
            <option value="03">ROTA 03</option>
            <option value="04">ROTA 04</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="driverFeedback">Motorista (opcional):</label>
          <input type="text" id="driverFeedback" placeholder="Número ou nome do motorista">
        </div>
        
        <div class="form-group">
          <label for="serviceMessage">Mensagem:</label>
          <textarea id="serviceMessage" rows="4" placeholder="Descreva seu feedback..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Avaliação:</label>
          <div class="rating-stars">
            <i class="fas fa-star" data-rating="1"></i>
            <i class="fas fa-star" data-rating="2"></i>
            <i class="fas fa-star" data-rating="3"></i>
            <i class="fas fa-star" data-rating="4"></i>
            <i class="fas fa-star" data-rating="5"></i>
          </div>
          <small id="ratingText">Clique nas estrelas para avaliar</small>
        </div>
        
        <button class="btn-submit" onclick="submitServiceFeedback()">
          <i class="fas fa-paper-plane"></i> Enviar Feedback
        </button>
      </div>
      
      <div class="tab-content" id="app">
        <div class="form-group">
          <label for="appFeedbackType">Tipo:</label>
          <select id="appFeedbackType">
            <option value="bug">Problema/Bug</option>
            <option value="suggestion">Sugestão de Melhoria</option>
            <option value="feature">Pedido de Nova Funcionalidade</option>
            <option value="other">Outro</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="appMessage">Descreva:</label>
          <textarea id="appMessage" rows="5" placeholder="Descreva sua sugestão ou problema..."></textarea>
        </div>
        
        <button class="btn-submit" onclick="submitAppFeedback()">
          <i class="fas fa-mobile-alt"></i> Enviar Feedback do App
        </button>
      </div>
      
      <div class="tab-content" id="history">
        <div class="feedback-history">
          <h4>Seus Feedbacks Anteriores</h4>
          <div id="feedbackHistory">
            <p class="empty-feedback">Nenhum feedback enviado ainda</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="app.js"></script>
  <script>
    // Inicializar página do passageiro
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar funcionalidades
      initPassengerPage();
      loadWeather();
      loadRoutesStatus();
      
      // Inicializar tema escuro
      initDarkMode();
    });
    
    function initPassengerPage() {
      console.log('Página do passageiro inicializada');
    }
    
    function openNotices() {
      openModal('noticesModal');
    }
    
    function openRouteTracking() {
      openModal('trackingModal');
    }
    
    function openFeedback() {
      openModal('feedbackModal');
      initRatingStars();
    }
    
    function openSupport() {
      window.open('https://wa.me/559392059914?text=Olá,%20preciso%20de%20suporte%20no%20app%20AC%20Transporte', '_blank');
    }
    
    function loadWeather() {
      // Simulação de dados de clima
      setTimeout(() => {
        document.getElementById('currentTemp').textContent = '28°C';
        document.getElementById('weatherDesc').textContent = 'Parcialmente nublado';
        document.getElementById('weatherLocation').textContent = 'Santarém, PA';
        document.getElementById('weatherIcon').innerHTML = '<i class="fas fa-cloud-sun"></i>';
      }, 1000);
    }
    
    function loadRoutesStatus() {
      // Simulação de status das rotas
      const routes = [
        { id: 'adm-01', name: 'ROTA ADM 01', status: 'active', drivers: 1, nextArrival: '10:15' },
        { id: 'adm-02', name: 'ROTA ADM 02', status: 'inactive', drivers: 0, nextArrival: '--:--' },
        { id: '01', name: 'ROTA 01', status: 'active', drivers: 2, nextArrival: '09:45' },
        { id: '02', name: 'ROTA 02', status: 'delayed', drivers: 1, nextArrival: '10:30' },
        { id: '03', name: 'ROTA 03', status: 'active', drivers: 1, nextArrival: '11:00' },
        { id: '04', name: 'ROTA 04', status: 'maintenance', drivers: 0, nextArrival: '--:--' }
      ];
      
      const grid = document.getElementById('routesStatusGrid');
      grid.innerHTML = '';
      
      routes.forEach(route => {
        const statusClass = route.status === 'active' ? 'active' : 
                          route.status === 'delayed' ? 'delayed' : 
                          route.status === 'maintenance' ? 'maintenance' : 'inactive';
        
        const statusText = route.status === 'active' ? 'Ativa' : 
                          route.status === 'delayed' ? 'Atrasada' : 
                          route.status === 'maintenance' ? 'Manutenção' : 'Inativa';
        
        const card = document.createElement('div');
        card.className = `status-card ${statusClass}`;
        card.innerHTML = `
          <div class="status-header">
            <h4>${route.name}</h4>
            <span class="status-badge ${statusClass}">${statusText}</span>
          </div>
          <div class="status-details">
            <div class="detail">
              <i class="fas fa-bus"></i>
              <span>${route.drivers} motorista(s)</span>
            </div>
            <div class="detail">
              <i class="fas fa-clock"></i>
              <span>Próxima: ${route.nextArrival}</span>
            </div>
          </div>
          <button class="btn-track-small" onclick="selectRouteForTracking('${route.id}')">
            <i class="fas fa-eye"></i> Acompanhar
          </button>
        `;
        
        grid.appendChild(card);
      });
      
      // Atualizar contador de motoristas
      const activeDrivers = routes.filter(r => r.drivers > 0).length;
      document.getElementById('driverStatus').textContent = `Motoristas disponíveis: ${activeDrivers}`;
    }
    
    function selectRouteForTracking(routeId) {
      openModal('trackingModal');
      document.getElementById('selectRoute').value = routeId;
      loadRouteDrivers();
    }
    
    function loadRouteDrivers() {
      const routeId = document.getElementById('selectRoute').value;
      if (!routeId) return;
      
      // Simulação de motoristas na rota
      const drivers = {
        'adm-01': [
          { id: 1, name: 'João Silva', vehicle: 'Ônibus 101', status: 'active', speed: '45 km/h', progress: '65%', eta: '10:15', distance: '2.5 km' }
        ],
        'adm-02': [],
        '01': [
          { id: 2, name: 'Maria Santos', vehicle: 'Ônibus 102', status: 'active', speed: '38 km/h', progress: '30%', eta: '09:45', distance: '5.2 km' },
          { id: 3, name: 'Pedro Costa', vehicle: 'Ônibus 103', status: 'active', speed: '42 km/h', progress: '75%', eta: '10:00', distance: '1.8 km' }
        ],
        '02': [
          { id: 4, name: 'Carlos Oliveira', vehicle: 'Ônibus 104', status: 'delayed', speed: '25 km/h', progress: '50%', eta: '10:30', distance: '3.7 km' }
        ],
        '03': [
          { id: 5, name: 'Ana Rodrigues', vehicle: 'Ônibus 105', status: 'active', speed: '40 km/h', progress: '20%', eta: '11:00', distance: '8.1 km' }
        ],
        '04': []
      };
      
      const routeDrivers = drivers[routeId] || [];
      const routeInfo = document.getElementById('routeInfo');
      const driversList = document.getElementById('driversList');
      const noDrivers = document.getElementById('noDrivers');
      const template = document.getElementById('driverTemplate');
      
      // Atualizar informações da rota
      routeInfo.style.display = 'block';
      document.getElementById('routeName').textContent = `ROTA ${routeId.toUpperCase()}`;
      document.getElementById('routeDuration').textContent = routeId.includes('adm') ? '45 min' : '2h 15min';
      document.getElementById('routeStops').textContent = routeId.includes('adm') ? '12' : '25';
      document.getElementById('routeDriversCount').textContent = routeDrivers.length;
      
      const overallStatus = routeDrivers.length > 0 ? 'Operando' : 'Sem motoristas';
      document.getElementById('routeOverallStatus').textContent = overallStatus;
      document.getElementById('routeOverallStatus').className = `route-status ${overallStatus === 'Operando' ? 'active' : 'inactive'}`;
      
      // Limpar lista anterior (exceto template e noDrivers)
      Array.from(driversList.children).forEach(child => {
        if (child.id !== 'driverTemplate' && child.id !== 'noDrivers') {
          child.remove();
        }
      });
      
      // Mostrar/ocultar "sem motoristas"
      if (routeDrivers.length === 0) {
        noDrivers.style.display = 'block';
      } else {
        noDrivers.style.display = 'none';
        
        // Adicionar motoristas
        routeDrivers.forEach(driver => {
          const clone = template.cloneNode(true);
          clone.id = `driver-${driver.id}`;
          clone.style.display = 'flex';
          
          clone.querySelector('.driver-name').textContent = driver.name;
          clone.querySelector('.vehicle-number').textContent = driver.vehicle.split(' ')[1];
          clone.querySelector('.status-text').textContent = driver.status === 'active' ? 'Em movimento' : 'Atrasado';
          clone.querySelector('.status-indicator').className = `status-indicator ${driver.status}`;
          
          clone.querySelector('.btn-track').onclick = function() {
            trackDriver(this, driver);
          };
          
          clone.querySelector('.btn-open-route').onclick = function() {
            openPassengerRoute(routeId);
          };
          
          driversList.appendChild(clone);
        });
      }
      
      // Atualizar mapa
      updateTrackingMap(routeId, routeDrivers);
    }
    
    function trackDriver(button, driver) {
      // Mostrar detalhes do motorista
      const details = document.getElementById('driverDetails');
      details.style.display = 'block';
      
      document.getElementById('selectedDriverName').textContent = driver.name;
      document.getElementById('selectedDriverVehicle').textContent = driver.vehicle;
      document.getElementById('driverSpeed').textContent = driver.speed;
      document.getElementById('lastUpdateTime').textContent = new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});
      document.getElementById('routeProgress').textContent = driver.progress;
      document.getElementById('estimatedArrival').textContent = driver.eta;
      document.getElementById('arrivalDistance').textContent = driver.distance;
      document.getElementById('arrivalTime').textContent = '15 min'; // Simulado
      
      // Rolar para os detalhes
      details.scrollIntoView({ behavior: 'smooth' });
      
      // Destacar motorista selecionado
      document.querySelectorAll('.driver-card').forEach(card => {
        card.classList.remove('selected');
      });
      button.closest('.driver-card').classList.add('selected');
    }
    
    function openPassengerRoute(routeId) {
      const routes = {
        'adm-01': 'https://www.google.com/maps/d/u/1/edit?mid=18BCgBpobp1Olzmzy0RnPCUEd7Vnkc5s&usp=sharing',
        'adm-02': 'https://www.google.com/maps/d/u/1/edit?mid=1WxbIX8nw0xyGBLMvvi1SF3DRuwmZ5oM&usp=sharing',
        '01': 'https://www.google.com/maps/d/u/1/edit?mid=1jCfFxq1ZwecS2IcHy7xGFLLgttsM-RQ&usp=sharing',
        '02': 'https://www.google.com/maps/d/u/1/edit?mid=1LCvNJxWBbZ_chpbdn_lk_Dm6NPA194g&usp=sharing',
        '03': 'https://www.google.com/maps/d/u/1/edit?mid=1bdwkrClh5AZml0mnDGlOzYcaR4w1BL0&usp=sharing',
        '04': 'https://www.google.com/maps/d/u/1/edit?mid=1ejibzdZkhX2QLnP9YgvvHdQpZELFvXo&usp=sharing'
      };
      
      window.open(routes[routeId], '_blank');
    }
    
    function updateTrackingMap(routeId, drivers) {
      const mapContainer = document.getElementById('trackingMap');
      mapContainer.innerHTML = `
        <div class="map-simulation">
          <div class="map-header">
            <h4><i class="fas fa-map"></i> Mapa da Rota ${routeId.toUpperCase()}</h4>
            <button class="btn-refresh" onclick="refreshMap()">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
          <div class="map-content">
            <div class="route-path">
              <div class="start-point">
                <i class="fas fa-flag-checkered"></i>
                <span>Início</span>
              </div>
              <div class="route-line">
                ${drivers.map((driver, index) => `
                  <div class="driver-marker" style="left: ${driver.progress};">
                    <i class="fas fa-bus"></i>
                    <div class="marker-tooltip">${driver.name}<br>${driver.vehicle}</div>
                  </div>
                `).join('')}
              </div>
              <div class="end-point">
                <i class="fas fa-flag"></i>
                <span>Fim</span>
              </div>
            </div>
            <div class="map-legend">
              <div class="legend-item">
                <span class="legend-color start"></span>
                <span>Ponto de Partida</span>
              </div>
              <div class="legend-item">
                <span class="legend-color driver"></span>
                <span>Motorista em Movimento</span>
              </div>
              <div class="legend-item">
                <span class="legend-color end"></span>
                <span>Ponto de Chegada</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    function refreshMap() {
      showNotification('info', 'Mapa atualizado');
    }
    
    function notifyDriverArrival() {
      showNotification('success', 'Você será notificado quando o motorista estiver chegando!');
    }
    
    function initRatingStars() {
      const stars = document.querySelectorAll('.rating-stars .fa-star');
      stars.forEach(star => {
        star.addEventListener('click', function() {
          const rating = this.getAttribute('data-rating');
          
          // Reset all stars
          stars.forEach(s => s.classList.remove('active'));
          
          // Activate stars up to clicked one
          for (let i = 0; i < rating; i++) {
            stars[i].classList.add('active');
          }
          
          // Update rating text
          const texts = ['Péssimo', 'Ruim', 'Regular', 'Bom', 'Excelente'];
          document.getElementById('ratingText').textContent = texts[rating - 1];
        });
      });
    }
    
    function submitServiceFeedback() {
      const type = document.getElementById('serviceType').value;
      const route = document.getElementById('routeFeedback').value;
      const message = document.getElementById('serviceMessage').value;
      
      if (!message.trim()) {
        showNotification('error', 'Digite sua mensagem!');
        return;
      }
      
      showNotification('success', 'Feedback enviado com sucesso!');
      closeModal('feedbackModal');
      
      // Aqui você enviaria para o Firebase
      console.log('Feedback enviado:', { type, route, message });
    }
    
    function submitAppFeedback() {
      const type = document.getElementById('appFeedbackType').value;
      const message = document.getElementById('appMessage').value;
      
      if (!message.trim()) {
        showNotification('error', 'Digite sua mensagem!');
        return;
      }
      
      showNotification('success', 'Feedback do app enviado com sucesso!');
      closeModal('feedbackModal');
    }
    
    function logout() {
      if (confirm('Deseja sair da conta?')) {
        localStorage.removeItem('user_profile');
        window.location.href = 'index.html';
      }
    }
    
    function goBack() {
      window.history.back();
    }
  </script>
  
  <style>
    /* Estilos específicos para passageiro.html */
    .passenger-header {
      background: linear-gradient(135deg, var(--passenger-color) 0%, #1976D2 100%);
      color: white;
      padding: 15px 0;
      margin-bottom: 20px;
    }
    
    .passenger-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-right: 15px;
    }
    
    .routes-status {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 30px;
      box-shadow: var(--shadow);
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .status-card {
      background: var(--light);
      border-radius: 8px;
      padding: 15px;
      border-left: 4px solid #ccc;
    }
    
    .status-card.active { border-left-color: var(--secondary); }
    .status-card.delayed { border-left-color: var(--warning); }
    .status-card.maintenance { border-left-color: var(--danger); }
    .status-card.inactive { border-left-color: #ccc; }
    
    .status-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-badge.active { background: var(--secondary); color: white; }
    .status-badge.delayed { background: var(--warning); color: white; }
    .status-badge.maintenance { background: var(--danger); color: white; }
    .status-badge.inactive { background: #ccc; color: #666; }
    
    .status-details {
      margin-bottom: 10px;
    }
    
    .detail {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
      font-size: 14px;
      color: #666;
    }
    
    .btn-track-small {
      width: 100%;
      background: var(--passenger-color);
      color: white;
      border: none;
      padding: 8px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .tracking-modal {
      max-width: 800px;
    }
    
    .route-selection {
      margin-bottom: 20px;
    }
    
    .route-info-card {
      background: white;
      border-radius: var(--radius);
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid #e0e0e0;
    }
    
    .route-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .route-details {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }
    
    .detail-item {
      text-align: center;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
    }
    
    .detail-item i {
      font-size: 24px;
      color: var(--passenger-color);
      margin-bottom: 5px;
    }
    
    .detail-item small {
      display: block;
      color: #666;
      font-size: 12px;
    }
    
    .detail-item p {
      font-weight: 600;
      margin: 5px 0 0 0;
    }
    
    .map-simulation {
      background: #f8f9fa;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .map-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: white;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .map-content {
      padding: 20px;
    }
    
    .route-path {
      height: 100px;
      background: white;
      border-radius: 8px;
      margin-bottom: 20px;
      position: relative;
      border: 2px dashed #e0e0e0;
    }
    
    .start-point, .end-point {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .start-point {
      left: 20px;
      color: var(--secondary);
    }
    
    .end-point {
      right: 20px;
      color: var(--primary);
    }
    
    .route-line {
      position: absolute;
      top: 50%;
      left: 50px;
      right: 50px;
      height: 4px;
      background: #e0e0e0;
      transform: translateY(-50%);
    }
    
    .driver-marker {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      background: var(--passenger-color);
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      animation: pulse 2s infinite;
    }
    
    .driver-marker:hover .marker-tooltip {
      display: block;
    }
    
    .marker-tooltip {
      display: none;
      position: absolute;
      top: -60px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      color: var(--dark);
      padding: 8px 12px;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      white-space: nowrap;
      font-size: 12px;
      z-index: 10;
      border: 1px solid #e0e0e0;
    }
    
    .map-legend {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .legend-color {
      width: 15px;
      height: 15px;
      border-radius: 50%;
    }
    
    .legend-color.start { background: var(--secondary); }
    .legend-color.driver { background: var(--passenger-color); }
    .legend-color.end { background: var(--primary); }
    
    .drivers-list {
      margin-top: 20px;
    }
    
    .driver-card {
      display: flex;
      align-items: center;
      padding: 15px;
      background: white;
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid #e0e0e0;
      transition: all var(--transition);
    }
    
    .driver-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    
    .driver-card.selected {
      border-color: var(--passenger-color);
      background: #f0f8ff;
    }
    
    .driver-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 20px;
      color: #666;
    }
    
    .driver-info {
      flex: 1;
    }
    
    .driver-name {
      margin: 0 0 5px 0;
      font-size: 16px;
    }
    
    .driver-vehicle {
      margin: 0 0 5px 0;
      font-size: 14px;
      color: #666;
    }
    
    .driver-status {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .status-indicator.active { background: var(--secondary); }
    .status-indicator.delayed { background: var(--warning); }
    
    .status-text {
      font-size: 12px;
      color: #666;
    }
    
    .driver-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn-track, .btn-open-route {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn-track {
      background: var(--passenger-color);
      color: white;
    }
    
    .btn-open-route {
      background: #f0f0f0;
      color: var(--dark);
    }
    
    .driver-details-card {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 20px;
      box-shadow: var(--shadow);
      border: 2px solid var(--passenger-color);
    }
    
    .driver-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .driver-avatar-large {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: var(--passenger-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      color: white;
    }
    
    .driver-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-item {
      text-align: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .stat-item i {
      font-size: 24px;
      color: var(--passenger-color);
      margin-bottom: 10px;
    }
    
    .estimated-arrival {
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .arrival-time {
      font-size: 32px;
      font-weight: bold;
      color: var(--passenger-color);
      margin: 10px 0;
    }
    
    .arrival-info {
      color: #666;
      font-size: 14px;
    }
    
    .btn-notify {
      width: 100%;
      padding: 15px;
      background: var(--passenger-color);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .rating-stars {
      display: flex;
      gap: 5px;
      margin: 10px 0;
    }
    
    .rating-stars .fa-star {
      font-size: 24px;
      color: #ddd;
      cursor: pointer;
      transition: color var(--transition);
    }
    
    .rating-stars .fa-star.active {
      color: #FFD700;
    }
    
    .no-drivers {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }
    
    .no-drivers i {
      font-size: 48px;
      color: #ccc;
      margin-bottom: 15px;
    }
    
    .btn-refresh {
      background: var(--passenger-color);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
  </style>
</body>
</html>
